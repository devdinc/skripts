import:
    java.util.HashMap
    
on load:
    set scoped {-key} to "plugin:test_pdt"
    
after each test:
    event-script is current script
    delete namespaced-key scoped {-key} within test-world if scoped {-key} is set
    
# since we use after each test we have to use devdinc test pattern here

devdinc test "pdc basic set/get with typed pdt":

    set namespaced-key scoped {-key} within test-world for pdt integer to 42
    assert namespaced-key scoped {-key} within test-world for pdt integer is 42 with "typed pdt get failed"

devdinc test "pdc overwrite typed value":

    set namespaced-key scoped {-key} within test-world for pdt string to "a"
    set namespaced-key scoped {-key} within test-world for pdt string to "b"

    assert namespaced-key scoped {-key} within test-world for pdt string is "b" with "overwrite failed"

devdinc test "pdc delete typed value":
    set namespaced-key scoped {-key} within test-world for pdt long to 100
    delete namespaced-key scoped {-key} within test-world for pdt long

    assert namespaced-key scoped {-key} within test-world for pdt long is not set with "delete failed"

devdinc test "pdc object serialization (byte_array implicit)":

    set {_obj} to new HashMap()
    {_obj}.put("a", 1)
    {_obj}.put("b", 2)

    set namespaced-key scoped {-key} within test-world to {_obj}

    set {_out} to namespaced-key scoped {-key} within test-world
    assert {_out}.get("a") is 1 with "object deserialize failed (a)"
    assert {_out}.get("b") is 2 with "object deserialize failed (b)"

devdinc test "pdc remove object via null":

    set namespaced-key scoped {-key} within test-world to "temp"
    set namespaced-key scoped {-key} within test-world to null

    assert namespaced-key scoped {-key} within test-world is not set with "object remove via null failed"

devdinc test "pdc holder vs direct pdc equivalence":
    set {_pdc} to test-world's pdc

    set namespaced-key scoped {-key} within test-world for pdt byte to 7
    assert namespaced-key scoped {-key} within {_pdc} for pdt byte is 7 with "direct pdc access failed"

devdinc test "pdc boolean pdt":

    set namespaced-key scoped {-key} within test-world for pdt boolean to true
    assert namespaced-key scoped {-key} within test-world for pdt boolean is true with "boolean pdt failed"

devdinc test "pdc default object missing returns none":

    assert namespaced-key scoped {-key} within test-world is not set with "missing object did not return none"

devdinc test "pdc unspecified pdt boolean":

    set namespaced-key scoped {-key} within test-world to true
    assert namespaced-key scoped {-key} within test-world is true with "unspecified boolean failed"

devdinc test "pdc unspecified pdt byte":

    set namespaced-key scoped {-key} within test-world to 5
    assert namespaced-key scoped {-key} within test-world is 5 with "unspecified byte failed"

devdinc test "pdc unspecified pdt short":

    set namespaced-key scoped {-key} within test-world to 12
    assert namespaced-key scoped {-key} within test-world is 12 with "unspecified short failed"

devdinc test "pdc unspecified pdt integer":

    set namespaced-key scoped {-key} within test-world to 123
    assert namespaced-key scoped {-key} within test-world is 123 with "unspecified integer failed"

devdinc test "pdc unspecified pdt long":

    set namespaced-key scoped {-key} within test-world to 123
    assert namespaced-key scoped {-key} within test-world is 123 with "unspecified long failed"

devdinc test "pdc unspecified pdt float":

    set namespaced-key scoped {-key} within test-world to 1.5
    assert namespaced-key scoped {-key} within test-world is 1.5 with "unspecified float failed"

devdinc test "pdc unspecified pdt double":
    
    set namespaced-key scoped {-key} within test-world to 2.75
    assert namespaced-key scoped {-key} within test-world is 2.75 with "unspecified double failed"


devdinc test "pdc unspecified pdt string":

    set namespaced-key scoped {-key} within test-world to "hello"
    assert namespaced-key scoped {-key} within test-world is "hello" with "unspecified string failed"

devdinc test "pdc unspecified pdt tag_container":

    set {_inner-pdc} to new pdc from test-world
    set {_inner-key} to "plugin:inner_key"
    set namespaced-key {_inner-key} within {_inner-pdc} for pdt integer to 9

    set namespaced-key scoped {-key} within test-world to {_inner-pdc}

    set {_out-pdc} to namespaced-key scoped {-key} within test-world
    assert namespaced-key {_inner-key} within {_out-pdc} for pdt integer is 9 with "unspecified tag_container failed"
