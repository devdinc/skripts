import:
    java.util.HashMap
    
on load:
    set scoped {-key} to namespaced-key "plugin:test_pdt"
    
after each test:
    delete scoped {-key} within test-world if scoped {-key} is set

test "pdc basic set/get with typed pdt":

    set scoped {-key} within test-world for pdt integer to 42
    assert scoped {-key} within test-world for pdt integer is 42 with "typed pdt get failed"


test "pdc overwrite typed value":

    set scoped {-key} within test-world for pdt string to "a"
    set scoped {-key} within test-world for pdt string to "b"

    assert scoped {-key} within test-world for pdt string is "b" with "overwrite failed"


test "pdc delete typed value":
    set scoped {-key} within test-world for pdt long to 100
    delete scoped {-key} within test-world for pdt long

    assert scoped {-key} within test-world for pdt long is not set with "delete failed"


test "pdc object serialization (byte_array implicit)":

    set {_obj} to new HashMap()
    {_obj}.put("a", 1)
    {_obj}.put("b", 2)

    set scoped {-key} within test-world to {_obj}

    set {_out} to scoped {-key} within test-world
    assert {_out}.get("a") is 1 with "object deserialize failed (a)"
    assert {_out}.get("b") is 2 with "object deserialize failed (b)"


test "pdc remove object via null":

    set scoped {-key} within test-world to "temp"
    set scoped {-key} within test-world to null

    assert scoped {-key} within test-world is not set with "object remove via null failed"


test "pdc holder vs direct pdc equivalence":
    set {_pdc} to test-world's pdc

    set scoped {-key} within test-world for pdt byte to 7
    assert scoped {-key} within {_pdc} for pdt byte is 7 with "direct pdc access failed"


test "pdc boolean pdt":

    set scoped {-key} within test-world for pdt boolean to true
    assert scoped {-key} within test-world for pdt boolean is true with "boolean pdt failed"


test "pdc default object missing returns none":

    assert scoped {-key} within test-world is not set with "missing object did not return none"

test "pdc unspecified pdt boolean":

    set scoped {-key} within test-world to true
    assert scoped {-key} within test-world is true with "unspecified boolean failed"


test "pdc unspecified pdt byte":

    set scoped {-key} within test-world to 5
    assert scoped {-key} within test-world is 5 with "unspecified byte failed"


test "pdc unspecified pdt short":

    set scoped {-key} within test-world to 12
    assert scoped {-key} within test-world is 12 with "unspecified short failed"


test "pdc unspecified pdt integer":

    set scoped {-key} within test-world to 123
    assert scoped {-key} within test-world is 123 with "unspecified integer failed"


test "pdc unspecified pdt long":

    set scoped {-key} within test-world to 123
    assert scoped {-key} within test-world is 123 with "unspecified long failed"


test "pdc unspecified pdt float":

    set scoped {-key} within test-world to 1.5
    assert scoped {-key} within test-world is 1.5 with "unspecified float failed"


test "pdc unspecified pdt double":
    
    set scoped {-key} within test-world to 2.75
    assert scoped {-key} within test-world is 2.75 with "unspecified double failed"


test "pdc unspecified pdt string":

    set scoped {-key} within test-world to "hello"
    assert scoped {-key} within test-world is "hello" with "unspecified string failed"


test "pdc unspecified pdt tag_container":

    set {_inner-pdc} to new pdc from test-world
    set {_inner-key} to namespaced-key "plugin:inner_key"
    set {_inner-key} within {_inner-pdc} for pdt integer to 9

    set scoped {-key} within test-world to {_inner-pdc}

    set {_out-pdc} to scoped {-key} within test-world
    assert {_inner-key} within {_out-pdc} for pdt integer is 9 with "unspecified tag_container failed"
